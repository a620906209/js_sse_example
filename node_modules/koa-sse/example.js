
/**
 * Module dependencies.
 */

var koa = require('koa');
var sse = require('./');
var Readable = require('stream').Readable;

/**
 * Koa app.
 */

var app = koa();

app.use(sse());
app.use(function*(){
  this.sse(objectStream());
});

app.listen(3000);
console.log('http://localhost:3000');

/**
 * Stream utility.
 */

function objectStream(){
  var stream = new Readable({ objectMode: true });
  var i = 0;
  stream._read = function(){
    this.push({
      foo: ++i
    });
    if (i == 3) this.push(null);
  }
  return stream;
}
